<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
    <script src="./js/spherical-env-map.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>
    <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script>
    <!--GUI Library-->
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
    <!--Environment extension-->
    <title>Tower</title>

</head>

<body>
    <a-scene physics="debug: false">

        <a-assets>
            <!-- Images -->
            <img id="gemImage" src="./assets/images/gem.png">
            <img id="sky" src="./assets/images/CloudySky.jpg">
            <img id="towerGame" src="./assets/images/topOfTheTower_desktopInstructions.png">
            <img id="kingMessage" src="./assets/images/kingMessage_07.png">


            <!-- Models -->
            <a-asset-item id="turret" src="./assets/models/Turret.glb"></a-asset-item>
            <a-asset-item id="gem" src="./assets/models/gem.obj"></a-asset-item>
            <a-asset-item id="bridge" src="./assets/models/Drawbridge.glb"></a-asset-item>
            <a-asset-item id="innerGatehouse" src="./assets/models/InnerGatehouse.glb"></a-asset-item>
            <a-asset-item id="wall" src="./assets/models/Wall1.glb"></a-asset-item>
            <a-asset-item id="keep" src="./assets/models/Keep.glb"></a-asset-item>
            <a-asset-item id="pillar" src="./assets/models/pillar.glb"></a-asset-item>
            <a-asset-item id="well" src="./assets/models/well.glb"></a-asset-item>
            <a-asset-item id="trapDoor" src="./assets/models/shortTable.glb"></a-asset-item>
            <a-asset-item id="fence" src="./assets/models/fence.glb"></a-asset-item>
            <a-asset-item id="tower" src="./assets/models/RoofedTurret.glb"></a-asset-item>
            <a-asset-item id="door" src="./assets/models/door.glb"></a-asset-item>
            <a-asset-item id="floor" src="./assets/models/Walls.glb"></a-asset-item>
            <a-asset-item id="table" src="./assets/models/shortTable.glb"></a-asset-item>
            <a-asset-item id="chair" src="./assets/models/chair.glb"></a-asset-item>

        </a-assets>

        <a-entity environment="preset: threetowers; dressingAmount: 0"></a-entity>
        <!-- Lighting  -->
        <a-light type="ambient" color="#222"></a-light>

        <a-entity id="cameraRig" player_position location movement-controls kinematic-body>
            <a-entity camera look-controls position="0 21.7 0">
                <a-cursor></a-cursor>

                <a-gui-label id="playerLocation" width="1.5" height="0.3" font-size="4rem" padding="1rem 2rem" position="3 1.8 -2.5" value="Tower">
                </a-gui-label>

                <a-entity visible="false" id="kingMessage_07" position="2.2 -0.5 -2.5">
                    <a-image src="#kingMessage" width="4" height=" 1.3"></a-image>
                </a-entity>

                <a-entity visible="false" id="towerInstructions" position="-2.2 -0.5 -2.5">
                    <a-image src="#towerGame" width="4" height=" 3"></a-image>
                </a-entity>

                <a-image class="gem" id="gem1" src="#gemImage" width="0.3" height="0.5" position="-3.5 1.8 -2.5" opacity="0.4"></a-image>
                <a-image class="gem" id="gem2" src="#gemImage" width="0.3" height="0.5" position="-3.1 1.8 -2.5" opacity="0.4"></a-image>
                <a-image class="gem" id="gem3" src="#gemImage" width="0.3" height="0.5" position="-2.7 1.8 -2.5" opacity="0.4"></a-image>
                <a-image class="gem" id="gem4" src="#gemImage" width="0.3" height="0.5" position="-2.3 1.8 -2.5" opacity="0.4"></a-image>
                <a-image class="gem" id="gem5" src="#gemImage" width="0.3" height="0.5" position="-1.9 1.8 -2.5" opacity="0.4"></a-image>
                <a-image class="gem" id="gem6" src="#gemImage" width="0.3" height="0.5" position="-1.5 1.8 -2.5" opacity="0.4"></a-image>
            </a-entity>
        </a-entity>

        <!-- Gem -->
        <a-obj-model towergem id="towerGem" material="color: green" src="#gem" position="1 17 -3" scale="0.1 0.1 0.1"></a-obj-model>


        <!-- Floor -->
        <a-plane static-body material="color: grey" width="1000" height="1000" rotation="-90 0 0" position="0 -0.2 -25"></a-plane>

        <!-- LIGHTING -->
        <a-light type="point" position="5.579 25.204 -2.032"></a-light>
        <a-light type="point" position="0 25.204 0"></a-light>

        <a-entity gltf-model="#tower" scale=" .01 .01 .01" position="0 0 0" rotation="0 0 0"></a-entity>

        <a-entity onclick="changeScene('inner_courtyard')" gltf-model="#trapDoor" scale=".01 .01 0.01" position="0 19.269 2.2" rotation="0, 0, 0"></a-entity>

        <a-gltf-model src="#keep" position="0 0 60.056" scale="2 2.5 2" rotation="0 90 0"></a-gltf-model>
        <a-gltf-model src="#keep" position="41.892 0 41.231" scale="2 2.5 2" rotation="0 180 0"></a-gltf-model>
        <a-gltf-model src="#keep" position="-22.857 0 60.056" scale="2 2.5 2" rotation="0 90 0"></a-gltf-model>
        <a-gltf-model src="#keep" position="-45.490 0 60.056" scale="2 2.5 2" rotation="0 90 0"></a-gltf-model>

        <a-entity gltf-model="#door" scale="1.4 1.4 1.4" position="0 0 29.523" rotation="0 180 0"></a-entity>
        <a-entity gltf-model="#door" scale="1.4 1.4 1.4" position="-18.093 0 21.369" rotation="0 90 0"></a-entity>

        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="19.085 0 6.067" rotation="0 72.574 0"></a-gltf-model>
        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="21.958 0 9.926" rotation="0 -26.893 0"></a-gltf-model>
        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="3.361 0 -3.394" rotation="0 26.903 0"></a-gltf-model>
        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="-19.085 0 7.723" rotation="0 90.000 0"></a-gltf-model>
        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="-49.728 0 8.004" rotation="0 90 0"></a-gltf-model>
        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="-19.579 0 8.934" rotation="0 0 0"></a-gltf-model>

        <a-gltf-model static-body material="color: grey" src="#turret" position="-19.085 0 9.697" scale="1 0.85 1"></a-gltf-model>
        <a-gltf-model static-body material="color: grey" src="#turret" position="18.135 0 9.697" scale="1 0.85 1"></a-gltf-model>
        <a-gltf-model static-body material="color: grey" src="#turret" position="-48.763 0 9.697" scale="1 0.85 1"></a-gltf-model>


        <a-gltf-model id="fences" src="#fence" scale="1 1 1" position="4.880 -1.196 18.261" rotation="0 0 0"></a-gltf-model>
        <a-gltf-model id="fences" src="#fence" scale="1 1 1" position="7.232 -1.196 20.978" rotation="0 90 0"></a-gltf-model>
        <a-gltf-model id="fences" src="#fence" scale="1 1 1" position="7.232 -1.196 15.286" rotation="0 90 0"></a-gltf-model>
        <a-gltf-model id="fences" src="#fence" scale="1 1 1" position="4.880 -1.196 6.702" rotation="0 0 0"></a-gltf-model>

        <a-entity gltf-model="#table" scale=".018 .018 0.018" position="7.120 0 14.127" rotation="0, 0, 0"></a-entity>
        <a-entity gltf-model="#table" scale=".018 .018 0.018" position="7.120 0 16.703" rotation="0, 0, 0"></a-entity>

        <a-entity gltf-model="#chair" scale=".025 .025 .025" position="7.120 0 11.665" rotation="0, -30.344, 0"></a-entity>
        <a-entity gltf-model="#chair" scale=".025 .025 .025" position="7.120 0 19.174" rotation="0, -135.474, 0"></a-entity>

        <a-entity text="value: Inner Courtyard; align: center; color:#be7150;" position="0 20.177 2.171" scale="5 5 1" rotation="-90 180 0"></a-entity>

        <a-box static-body visible="false" position="-0.420 21 3.8" scale="10 100 0.5"></a-box>
        <a-box static-body visible="false" position="-0.420 21 -3.8" scale="10 100 0.5"></a-box>
        <a-box static-body visible="false" position="-3.85 21 0.13" scale="0.45 100 10.8"></a-box>
        <a-box static-body visible="false" position="3.85 21 0.13" scale="0.45 100 10.8"></a-box>


    </a-scene>

    <script src="./js/scoreSystem.js"></script>
    <script src="./js/message_07_controller.js"></script>
    <script src="./js/gemItemControl.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        function changeScene(val) {
            if (val == 'inner_courtyard') {
                socket.emit('inner_courtyard') //calls server method
            }
        };

        let socket = io();
        //default connect event
        socket.on('connect', function() {
            console.log("connected!");
        });

        socket.on('pageLocationQuery', (data) => {
            socket.emit('mobileLoadTower');
        });

        socket.on('inner_courtyard', function(data) {
            window.location.replace('innercourtyard') //Call
        });
    </script>
</body>

</html>