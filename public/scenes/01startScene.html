<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
    <script src="./js/scene1PositionTrigger.js"></script>
    <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script> <!--GUI Library-->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script> <!--Physics Library-->
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script> <!--Environment extension-->
    <title>Courtyard and Entrance Scene</title>
</head>
<body>
    <a-scene>

        <a-assets>
            <a-asset-item id="gatehouse" src="./assets/models/Gatehouse.obj"></a-asset-item>
            <a-asset-item id="turret" src="./assets/models/Turret.obj"></a-asset-item>
            <a-asset-item id="well" src="./assets/models/well.obj"></a-asset-item>
        </a-assets>

        <a-entity environment="preset: threetowers; dressingAmount: 0"></a-entity>
        
            <a-entity player_position id="cameraRig" position="0 1.7 55">
                <a-camera look-controls wasd-controls="acceleration: 420" position="0 0 0">
                    <a-cursor></a-cursor>
                    <a-gui-label 
                        id="playerLocation"
                        width="1" height="0.2"
                        font-size="4.5rem"
                        padding="1rem 2rem"
                        position="2 1.5 -2"
                        value="Servants Quarters"
                    >
                    </a-gui-label>
                </a-camera> 
            </a-entity> 

            <!-- forward position reference -->
            <a-box position="0 0 49" scale="1 1 1" material="color: blue"></a-box> 

            <!-- outer walls -->
            <a-box material="color: grey" scale="20 10 1.5" position="-16 5 35" rotation="0 -70 0"></a-box>
            <a-box material="color: grey" scale="20 10 1.5" position="16 5 35" rotation="0 70 0"></a-box>
            <a-box material="color: grey" scale="13 10 1.5" position="-19 5 18" rotation="0 90 0"></a-box>
            <a-box material="color: grey" scale="13 10 1.5" position="19 5 18" rotation="0 90 0"></a-box>

            <!--towers (turrets) -->
                <!-- outer wall towers -->
                <a-obj-model material="color: grey" src="#turret" position="-19 0 27" scale="0.008 0.006 0.008"></a-obj-model>
                <a-obj-model material="color: grey" src="#turret" position="19 0 27" scale="0.008 0.006 0.008"></a-obj-model>

                <!-- castle front towers -->
                <a-obj-model material="color: grey" src="#turret" position="-19 0 12" scale="0.009 0.007 0.009"></a-obj-model>
                <a-obj-model material="color: grey" src="#turret" position="19 0 12" scale="0.009 0.007 0.009"></a-obj-model>
                <a-obj-model material="color: grey" src="#turret" position="-7.5w 0 13" scale="0.0075 0.009 0.007"></a-obj-model>
                <a-obj-model material="color: grey" src="#turret" position="7.5w 0 13" scale="0.0075 0.009 0.007"></a-obj-model>


            <!-- castle front walls -->
            <a-box material="color: grey" scale="10 10 1.5" position="-11 5 13" rotation="0 -10 0"></a-box>
            <a-box material="color: grey" scale="10 10 1.5" position="11 5 13" rotation="0 10 0"></a-box>

            <!-- wall walkways -->
                <!-- front walkway -->
                <a-box material="color: brown" scale="25 0.5 2.2" position="0 9.2 43.2"></a-box>
                <a-box material="color: brown" scale="0.5 10 0.5" position="5 4 43"></a-box>
                <a-box material="color: brown" scale="0.5 10 0.5" position="-5 4 43"></a-box>

                <!-- right walkways -->
                <a-box material="color: brown" scale="15 0.5 2.4" position="17.5 8 20" rotation="0 90 0"></a-box>
                <a-box material="color: brown" scale="0.5 8 0.5" position="17 4 16" rotation="0 90 0"></a-box>
                <a-box material="color: brown" scale="0.5 8 0.5" position="17 4 24" rotation="0 90 0"></a-box>

                <!-- left walkway -->
                <a-box material="color: brown" scale="15 0.5 2.4" position="-17.5 8 20" rotation="0 90 0"></a-box>
                <a-box material="color: brown" scale="0.5 8 0.5" position="-17 4 16" rotation="0 90 0"></a-box>
                <a-box material="color: brown" scale="0.5 8 0.5" position="-17 4 24" rotation="0 90 0"></a-box>

            <!-- front gatehouse -->
            <a-obj-model material="color: grey" src="#gatehouse" position="0 0 45" rotation="0 90 0" scale="0.005 0.0051 0.005"></a-obj-model>

            <!--courtyard 1 well -->
            <a-obj-model material="color: grey" src="#well" position="-12 0 26" rotation="0 45 0" scale="1.2 1.2 1.2"></a-obj-model>

            <!-- Lights -->
            
    </a-scene>

    <script src="/socket.io/socket.io.js"></script>
    <script>

        let locator = document.getElementById('playerLocation');
        let themeFont = new FontFace('Enchanted', 'url(../fonts/EnchantedLand.otf)');
        const path = window.location.pathname;
        const page = path.split('/').pop();
        
        if (page == "scene1"){
            locator.setAttribute('value', "Main Courtyard");
            locator.setAttribute('font-family', "Enchanted")
        } 

        let playerCamera = document.getElementById('cameraRig');
        let worldPos = new THREE.Vector3();

        worldPos.setFromMatrixPosition(playerCamera.object3D.matrixWorld);
        playerCamera.addEventListener('componentchanged', function (event) {
            if (event.detail.name !== 'position') { return; }
            console.log(event.detail.newData);
        });

        function changeScene(val){
            if(val == 2){
                socket.emit('change_to_scene2') //calls server method
            }
        };

        let socket = io(); 
        //default connect event
        socket.on('connect', function() {
            console.log("connected!");
        });

        socket.on('scene_2', function(data) {
            window.location.replace('02entrance.html')
        });

    </script>
</body>
</html>