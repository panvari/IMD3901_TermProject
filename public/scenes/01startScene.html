<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
    <script src="./js/scene1PositionTrigger.js"></script>
    <script src="./js/popup.js"></script>
    <!-- <script src="./js/locationManager.js"></script> -->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>
    <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script> <!--GUI Library-->
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script> <!--Environment extension-->
    <title>Courtyard and Entrance Scene</title>

</head>
<body>
    <a-scene physics="debug: false">

        <a-assets>
            <a-asset-item id="gatehouse" src="./assets/models/Gatehouse.obj"></a-asset-item>
            <a-asset-item id="turret" src="./assets/models/Turret.obj"></a-asset-item>
            <a-asset-item id="well" src="./assets/models/well.obj"></a-asset-item>

            <a-asset-item id="gem" src="./assets/models/gem.obj"></a-asset-item>
            <a-asset-item id="bridge" src="./assets/models/Drawbridge.glb"></a-asset-item> 
            <a-asset-item id="innerGatehouse" src="./assets/models/InnerGatehouse.glb"></a-asset-item>
            <a-asset-item id="wall" src="./assets/models/Wall1.glb"></a-asset-item>
        </a-assets>

        <a-entity environment="preset: threetowers; dressingAmount: 0"></a-entity>
            
            <a-entity location id="rig" movement-controls kinematic-body>
                <a-entity id="camera" camera look-controls position="0 1.7 0">
                    <a-cursor></a-cursor>

                    <a-gui-label 
                            id="playerLocation"
                            width="1" height="0.2"
                            font-size="4.5rem"
                            padding="1rem 2rem"
                            position="2 1.5 -2"
                            value="Servants Quarters">
                    </a-gui-label>

                    <a-entity
                        visible="false"
                        id="popUp"
                        geometry="primitive: plane; width: 3; height: 3.5"
                        material="color: white"
                        text=" width: 2.8; align: left; font: https://cdn.aframe.io/fonts/Exo2SemiBold.fnt; color: white; baseline: bottom; letterSpacing: 3; lineHeight:40; value: Lorem ipsum dolor, sit amet consectetur adipisicing elit. Dolorem iste distinctio facere error in? Natus dolorum modi, aspernatur amet praesentium eveniet, ea ex aliquam voluptatem repellat nesciunt minima non autem, labore facilis perspiciatis quis. Eius, tempore accusamus! Quos, ipsa eos aliquam vero architecto quae eligendi voluptate ex corrupti mollitia ducimus. "
                        position="-2.5 0.2 -2.5">
                    </a-entity>
                </a-entity>
            </a-entity>
 
            <a-obj-model popup id="gemItem" material="color: green" src="#gem" position="5 -1 -25" scale="0.1 0.1 0.1"></a-obj-model>

            <!-- Floor -->
            <a-plane static-body material="color: grey" width="1000" height="1000" rotation="-90 0 0" position="0 -0.2 -25"></a-plane>  

            <!-- outer walls -->
            <a-box static-body rotation="0 -70 0" position="-16 5 -10" material="color: grey" scale="20 10 1.5"></a-box>

            <a-box static-body material="color: grey" scale="20 10 1.5" position="16 5 -10" rotation="0 70 0"></a-box>
            <a-box static-body material="color: grey" scale="13 10 1.5" position="-19 5 -28" rotation="0 90 0"></a-box>
            <a-box static-body material="color: grey" scale="13 10 1.5" position="19 5 -28" rotation="0 90 0"></a-box>

            <!--towers (turrets) -->
                <!-- outer wall towers -->
                <a-obj-model material="color: grey" src="#turret" position="-19 0 -37" scale="0.008 0.006 0.008"></a-obj-model>
                <a-obj-model material="color: grey" src="#turret" position="19 0 -37" scale="0.008 0.006 0.008"></a-obj-model>

                <!-- castle front -->
                <a-obj-model static-body material="color: grey" src="#turret" position="-19 0 -22" scale="0.009 0.007 0.009"></a-obj-model>
                <a-obj-model static-body material="color: grey" src="#turret" position="19 0 -22" scale="0.009 0.007 0.009"></a-obj-model>
                <a-obj-model static-body material="color: grey" src="#turret" position="-7.5 0 -35" scale="0.0075 0.0075 0.007"></a-obj-model>
                <a-obj-model static-body material="color: grey" src="#turret" position="7.5 0 -35" scale="0.0075 0.0075 0.007"></a-obj-model>

                <a-gltf-model id="drawBridge" src="#bridge" scale="1.2 1.7 2" position="0 0 6" rotation="0 -90 0"></a-gltf-model>
                <a-gltf-model id="gatehouse" src="#innerGatehouse" scale="2 1.7 2.0" position="0 0 1" rotation="0 -90 0"></a-gltf-model>            
               
            <!-- castle front walls -->
            <a-box static-body material="color: grey" scale="10 10 1.5" position="-11 5 -36" rotation="0 -10 0"></a-box>
            <a-box static-body material="color: grey" scale="10 10 1.5" position="11 5 -36" rotation="0 10 0"></a-box>

            <!-- wall walkways -->
                <!-- front walkway -->
                <a-box static-body material="color: brown" scale="25 0.5 2.2" position="0 9.2 -1.8"></a-box>
                <a-box static-body material="color: brown" scale="0.5 10 0.5" position="5 4 -1.6"></a-box>
                <a-box static-body material="color: brown" scale="0.5 10 0.5" position="-5 4 -1.6"></a-box>

                <!-- right walkways -->
                <a-box static-body material="color: brown" scale="15 0.5 2.4" position="17.5 8 -28" rotation="0 90 0"></a-box>
                <a-box static-body material="color: brown" scale="0.5 8 0.5" position="17 4 -26" rotation="0 90 0"></a-box>
                <a-box static-body material="color: brown" scale="0.5 8 0.5" position="17 4 -32" rotation="0 90 0"></a-box>

                <!-- left walkway -->
                <a-box static-body material="color: brown" scale="15 0.5 2.4" position="-17.5 8 -28" rotation="0 90 0"></a-box>
                <a-box static-body material="color: brown" scale="0.5 8 0.5" position="-17 4 -26" rotation="0 90 0"></a-box>
                <a-box static-body material="color: brown" scale="0.5 8 0.5" position="-17 4 -32" rotation="0 90 0"></a-box>

            <!-- front gatehouse -->
            <!-- <a-obj-model material="color: grey" src="#gatehouse" position="0 0 -2" rotation="0 90 0" scale="0.005 0.0051 0.005"></a-obj-model> -->

            <!--courtyard 1 well -->
            <a-obj-model static-body material="color: grey" src="#well" position="-12 0 -26" rotation="0 45 0" scale="1.2 1.2 1.2"></a-obj-model>

            <!-- Lights -->
            
    </a-scene>

    <script src="/socket.io/socket.io.js"></script>
    <script>

        let locator = document.getElementById('playerLocation');
        let themeFont = new FontFace('Enchanted', 'url(../fonts/EnchantedLand.otf)');
        const path = window.location.pathname;
        const page = path.split('/').pop();
        
        if (page == "scene1"){
            locator.setAttribute('value', "Main Courtyard");
            locator.setAttribute('font-family', "Enchanted")
        } 

        let playerCamera = document.getElementById('cameraRig');
        let worldPos = new THREE.Vector3();

        worldPos.setFromMatrixPosition(playerCamera.object3D.matrixWorld);
        playerCamera.addEventListener('componentchanged', function (event) {
            if (event.detail.name !== 'position') { return; }
            console.log(event.detail.newData);
        });

        function changeScene(val){
            if(val == 2){
                socket.emit('change_to_scene2') //calls server method
            }
        };

        let socket = io(); 
        //default connect event
        socket.on('connect', function() {
            console.log("connected!");
        });

        socket.on('scene_2', function(data) {
            window.location.replace('02entrance.html')
        });

    </script>
</body>
</html>