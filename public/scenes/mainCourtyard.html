<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
    <script src="./js/spherical-env-map.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>
    <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script>
    <!--GUI Library-->
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
    <!--Environment extension-->
    <title>Outer Courtyard</title>

</head>

<body>
    <a-scene physics="debug: false">

        <a-assets>
            <!-- Images -->
            <img id="gemImage" src="./assets/images/gem.png">
            <img id="sky" src="./assets/images/CloudySky.jpg">
            <img id="kingMessage" src="./assets/images/kingMessage_01.png">


            <!-- Models -->
            <a-asset-item id="turret" src="./assets/models/Turret.glb"></a-asset-item>
            <a-asset-item id="gem" src="./assets/models/gem.obj"></a-asset-item>
            <a-asset-item id="bridge" src="./assets/models/Drawbridge.glb"></a-asset-item>
            <a-asset-item id="innerGatehouse" src="./assets/models/InnerGatehouse.glb"></a-asset-item>
            <a-asset-item id="wall" src="./assets/models/Wall1.glb"></a-asset-item>
            <a-asset-item id="keep" src="./assets/models/Keep.glb"></a-asset-item>
            <a-asset-item id="pillar" src="./assets/models/pillar.glb"></a-asset-item>
            <a-asset-item id="well" src="./assets/models/well.glb"></a-asset-item>

            <a-asset-item id="dummy" src="./assets/models/trainingDummy.glb"></a-asset-item>
            <a-asset-item id="fence" src="./assets/models/fence.glb"></a-asset-item>

        </a-assets>

        <a-entity environment="preset: threetowers; dressingAmount: 0"></a-entity>
        <!-- Lighting  -->
        <a-light type="ambient" color="#222"></a-light>

        <a-entity id="cameraRig" player_position location movement-controls kinematic-body>
            <a-entity camera look-controls position="0 2.8 0">
                <a-cursor></a-cursor>

                <a-gui-label id="playerLocation" width="1.5" height="0.3" font-size="4rem" padding="1rem 2rem" position="3 1.8 -2.5" value="Outer Courtyard">
                </a-gui-label>

                <a-entity visible="false" id="kingMessage_01" position="-2.2 -0.5 -2.5">
                    <a-image src="#kingMessage" width="4" height=" 1.3"></a-image>
                </a-entity>

                <a-image class="gem" id="gem1" src="#gemImage" width="0.3" height="0.5" position="-3.5 1.8 -2.5" opacity="0.4"></a-image>
                <a-image class="gem" id="gem2" src="#gemImage" width="0.3" height="0.5" position="-3.1 1.8 -2.5" opacity="0.4"></a-image>
                <a-image class="gem" id="gem3" src="#gemImage" width="0.3" height="0.5" position="-2.7 1.8 -2.5" opacity="0.4"></a-image>
                <a-image class="gem" id="gem4" src="#gemImage" width="0.3" height="0.5" position="-2.3 1.8 -2.5" opacity="0.4"></a-image>
                <a-image class="gem" id="gem5" src="#gemImage" width="0.3" height="0.5" position="-1.9 1.8 -2.5" opacity="0.4"></a-image>
                <a-image class="gem" id="gem6" src="#gemImage" width="0.3" height="0.5" position="-1.5 1.8 -2.5" opacity="0.4"></a-image>
            </a-entity>
        </a-entity>

        <!-- Floor -->
        <a-plane static-body material="color: grey" width="1000" height="1000" rotation="-90 0 0" position="0 -0.2 -25"></a-plane>

        <!-- outer wall Colliders -->
        <!-- Front walls -->
        <a-box static-body rotation="0 -60 0" position="-17 4 -10" material="color: grey" scale="20 10 0.5"></a-box>
        <a-box static-body material="color: grey" scale="20 10 0.5" position="18 4 -10" rotation="0 60.5 0"></a-box>
        <!-- Side Walls -->
        <a-box static-body material="color: grey" scale="13 10 0.5" position="-24 4 -28" rotation="0 -85 0"></a-box>
        <a-box static-body material="color: grey" scale="13 10 0.5" position="24 4 -28" rotation="0 82 0"></a-box>
        <!-- Back Walls -->
        <a-box static-body material="color: grey" scale="13 10 0.5" position="-19 4 -38" rotation="0 -170 0"></a-box>
        <a-box static-body material="color: grey" scale="13 10 0.5" position="19 4 -38" rotation="0 170 0"></a-box>
        <!--towers (turrets) -->
        <!-- outer wall towers -->
        <a-gltf-model static-body material="color: grey" src="#turret" position="-25 0 -37" scale="1 0.85 1"></a-gltf-model>
        <a-gltf-model static-body material="color: grey" src="#turret" position="25 0 -37" scale="1 0.85 1"></a-gltf-model>

        <!-- castle front -->
        <a-gltf-model static-body material="color: grey" src="#turret" position="-22 0 -18" scale="1 0.85 1"></a-gltf-model>
        <a-gltf-model static-body material="color: grey" src="#turret" position="22 0 -18" scale="1 0.85 1"></a-gltf-model>
        <a-gltf-model static-body material="color: grey" src="#turret" position="-10.5 0 1.5" scale="1 0.85 1"></a-gltf-model>
        <a-gltf-model static-body material="color: grey" src="#turret" position="10.5 0 1.5" scale="1 0.85 1"></a-gltf-model>
        <a-gltf-model id="drawBridge" src="#bridge" scale="1.2 1.7 2" position="0 0 6" rotation="0 -90 0"></a-gltf-model>

        <!-- LIGHTING -->
        <a-light type="point" position="0 -10 0"></a-light>
        <a-light type="point" position="0 10 0"></a-light>

        <!-- Outside Area area -->
        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="0 -1.5 -41" rotation="0 -90 0"></a-gltf-model>
        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="5 -1.5 -41" rotation="0 -90 0"></a-gltf-model>

        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="0 -1.5 -37" rotation="0 -90 0"></a-gltf-model>
        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="5 -1.5 -37" rotation="0 -90 0"></a-gltf-model>

        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="0 -1.5 -33" rotation="0 -90 0"></a-gltf-model>
        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="5 -1.5 -33" rotation="0 -90 0"></a-gltf-model>

        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="0 -1.5 -29" rotation="0 -90 0"></a-gltf-model>
        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="5 -1.5 -29" rotation="0 -90 0"></a-gltf-model>

        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="0 -1.5 -25" rotation="0 -90 0"></a-gltf-model>
        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="5 -1.5 -25" rotation="0 -90 0"></a-gltf-model>

        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="0 -1.5 -21" rotation="0 -90 0"></a-gltf-model>
        <a-gltf-model id="fences" src="#fence" scale="0.8 0.8 0.8" position="5 -1.5 -21" rotation="0 -90 0"></a-gltf-model>

        <a-gltf-model static-body material="color: grey" src="#turret" position="-2.5 -1 -16.5" scale="0.12 0.12 0.12"></a-gltf-model>
        <a-gltf-model static-body material="color: grey" src="#turret" position="2.5 -1 -16.5" scale="0.12 0.12 0.12"></a-gltf-model>

        <!-- Front Wall Models -->
        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="9 0 6" rotation="0 -120 0"></a-gltf-model>
        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="-9.5 0 3.1" rotation="0 -60 0"></a-gltf-model>
        <!-- Middle Wall Models -->
        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="-23.6 0 -17" rotation="0 -85 0"></a-gltf-model>
        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="26.4 0 -43.3" rotation="0 82 0"></a-gltf-model>

        <!-- Back Wall Models -->
        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="5 0 -41" rotation="0 170 0"></a-gltf-model>
        <a-gltf-model id="walls" src="#wall" scale="0.5 0.8 1" position="-29.8 0 -36" rotation="0 -170 0"></a-gltf-model>


        <!-- front gatehouse -->
        <a-gltf-model material="color: grey" src="#innerGatehouse" position="0 0 2" rotation="0 -90 0" scale="2 1.8 2"></a-gltf-model>

        <!--courtyard 1 well -->
        <a-gltf-model spherical-map static-body src="#well" position="-12 0 -26" rotation="0 45 0" scale="1.2 1.2 1.2"></a-gltf-model>

        <!-- Keep -->
        <a-gltf-model src="#keep" position="0 0 -37" scale="2 2.5 2" rotation="0 90 0"></a-gltf-model>


        <a-box static-body visible="false" position="-2.4 0.7 -28.5" scale="0.3 3 24"></a-box>
        <a-box static-body visible="false" position="2.4 0.7 -28.5" scale="0.3 3 24"></a-box>

        <a-box onclick="changeScene('great_hall')" static-body visible="false" position="0 2.9 -39.5" scale="4 5.3 1"></a-box>
    </a-scene>

    <script src="./js/gemItemControl.js"></script>
    <script src="./js/scoreSystem.js"></script>
    <script src="./js/message_01_controller.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        function changeScene(val) {
            if (val == 'great_hall') {
                socket.emit('great_hall') //calls server method
            }
        };

        let socket = io();
        //default connect event
        socket.on('connect', function() {
            console.log("connected!");
        });

        socket.on('great_hall', function(data) {
            window.location.replace('greathall') //Call
        });
    </script>
</body>

</html>