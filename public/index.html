<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
    <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script> <!--GUI Library-->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script> <!--Physics Library-->
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script> <!--Environment extension-->

    <title>Term Project - IMD3901</title>
</head>
<body>
    <a-scene physics="debug:true">

        <a-entity environment="preset: threetowers"></a-entity>

        <a-assets>
            <!-- Josh Models -->
            <a-asset-item id="gatehouse" src="./assets/models/Gatehouse.obj"></a-asset-item>
            <a-asset-item id="wall1" src="./assets/models/Wall1.obj"></a-asset-item>
            <a-asset-item id="RoofedTurret" src="./assets/models/RoofedTurret.obj"></a-asset-item>
            <a-asset-item id="bed" src="./assets/models/Bed.obj"></a-asset-item>
            <a-asset-item id="bucket" src="./assets/models/Bucket.obj"></a-asset-item>
            <a-asset-item id="room" src="./assets/models/Room.obj"></a-asset-item>
            <a-asset-item id="turret" src="./assets/models/Turret.obj"></a-asset-item>
            <a-asset-item id="box" src="./assets/models/Box.obj"></a-asset-item>
            <a-asset-item id="cheese" src="./assets/models/Cheese.glb"></a-assasset-item>

            <!-- Pauline Models -->
            <a-asset-item id="stool" src="./assets/models/stool.obj"></a-asset-item>
            <a-asset-item id="gem" src="./assets/models/gem.obj"></a-asset-item>
            <a-asset-item id="table" src="./assets/models/table.obj"></a-asset-item>
            <a-asset-item id="candle" src="./assets/models/candle.obj"></a-asset-item>
        </a-assets>

        <a-entity player_position id="cameraRig" position="0 1.6 0">
            <a-camera look-controls wasd-controls="acceleration: 220" position="0 0 0">
                <a-cursor></a-cursor>
                <a-gui-label 
                    id="playerScore"
                    width="1" height="0.2"
                    font-family="Arial"
                    font-size="50px"
                    padding="1rem 2rem"
                    position="2 1.5 -2"
                    value="Servants Quarters"
                >
                </a-gui-label>
            </a-camera> 
        </a-entity> 
        
        <!-- josh models -->
        <a-obj-model id="room" material="color: grey" src="#room" position="0 0 -10" scale="0.009 0.015 0.009"></a-obj-model>
        <a-obj-model id="box" material="color: #342618" src="#box" position="2 0 -15.9" scale="0.018 0.018 0.009"></a-obj-model>
        <a-obj-model id="box" material="color: #342618" src="#box" position="-1 0 -15.9" scale="0.018 0.018 0.009"></a-obj-model>
        <a-obj-model id="box" material="color: #342618" src="#box" position="-3.5 0 -6" scale="0.018 0.018 0.009" rotation="0 90 0"></a-obj-model>
        <a-obj-model material="color: white" src="#bed" position="2.3 -0.8 -13" scale="0.15 0.3 0.2" rotation="0 -180 0"></a-obj-model>
        <a-obj-model material="color: white" src="#bed" position="2.3 -0.8 -10" scale="0.15 0.3 0.2" rotation="0 -180 0"></a-obj-model>
        <a-obj-model material="color: white" src="#bed" position="2.3 -0.8 -7" scale="0.15 0.3 0.2" rotation="0 -180 0"></a-obj-model>
        <a-obj-model material="color: #747373" src="#bucket" position="-2 0.4 -12" scale="0.004 0.0029 0.004"></a-obj-model>
        <a-obj-model material="color: grey" src="#turret" position="6 0 -4" scale="0.005 0.005 0.005"></a-obj-model> <!-- Turret Right -->
        <a-obj-model material="color: grey" src="#turret" position="-6 0 -4" scale="0.005 0.005 0.005"></a-obj-model>  <!-- Turret Left -->

        <a-obj-model material="color: grey" src="#wall1" position="4 0 8" rotation="0 70 0" scale="0.005 0.005 0.005"></a-obj-model>
        <a-obj-model material="color: grey" src="#wall1" position="-4 0 8" rotation="0 -70 0" scale="0.005 0.005 0.005"></a-obj-model>
        <a-obj-model material="color: #47280A" src="#gatehouse" position="0 0 -5" rotation="0 90 0" scale="0.002 0.0028 0.006"></a-obj-model>
        <a-obj-model material="color: #47280A" src="#gatehouse" position="0 0 -9" rotation="0 90 0" scale="0.002 0.0028 0.006"></a-obj-model>
        <a-obj-model material="color: #47280A" src="#gatehouse" position="0 0 -13" rotation="0 90 0" scale="0.002 0.0028 0.006"></a-obj-model>
        
        <a-gltf-model src="#cheese" id="button" position="0 0 0" rotation="0 0 0" scale="0.3 0.3 0.3"></a-gltf-model>


        <!-- Pauline models -->
        <a-obj-model material="color: #47280A" src="#stool" scale="0.02 0.02 0.02" position="3 0 -4"></a-obj-model>
        <a-obj-model animation="property: rotation; easing: linear; to: 0 360 0; loop: true; dur: 4000" material="color: green" src="#gem" scale="0.05 0.05 0.05" position="3.5 0 -10"></a-obj-model>
        <a-obj-model material="color: #47280A" src="#table" scale="0.012 0.01 0.018" position="-3 0 -10" rotation="0 0 0"></a-obj-model>
        <a-obj-model material="color: white" src="#candle" scale="0.18 0.18 0.18" position="-3 0.75 -11" rotation="0 0 0"></a-obj-model>

    </a-scene>

    <!-- Socket Script -->
    <script src="/socket.io/socket.io.js"></script>
    <script>

        let playerCamera = document.getElementById('cameraRig');
        let worldPos = new THREE.Vector3();

         worldPos.setFromMatrixPosition(playerCamera.object3D.matrixWorld);
         console.log(worldPos.x, worldPos.y, worldPos.z);


        playerCamera.addEventListener('componentchanged', function (event) {
            if (event.detail.name !== 'position') { return; }
            console.log(event.detail.newData);
        });

        let socket = io(); 

        // setInterval(function(){
        //     let playerCamera = document.getElementById('cameraRig');
        //     //check every 100ms
        //     console.log(playerCamera);
        // }, 1000)

        let changeScene = document.getElementById('button');
        changeScene.addEventListener('click', () => {
            socket.emit('change_to_scene2')
        });

        //default connect event
        socket.on('connect', function() {
            console.log("connected!");
        });

        socket.on('scene_1', function(data) {
            window.location.replace('index.html')
        });

        socket.on('scene_2', function(data) {
            window.location.replace('newScene.html')
        });

        // socket.emit('green');

    </script>
    <script src="./js/positionTriggers.js"></script>
</body>
</html>